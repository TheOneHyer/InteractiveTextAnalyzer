import{g as xt,a as yt,r as et,j as mt}from"./index-BhwZeMYX.js";import{a3 as pt,o as vt,a4 as gt,a5 as wt}from"./d3-core-BQA7b1Lo.js";import"./xlsx-lib-eYdzo_tC.js";var Mt={value:function(){}};function at(){for(var r=0,f=arguments.length,o={},a;r<f;++r){if(!(a=arguments[r]+"")||a in o||/[\s.]/.test(a))throw new Error("illegal type: "+a);o[a]=[]}return new H(o)}function H(r){this._=r}function zt(r,f){return r.trim().split(/^|\s+/).map(function(o){var a="",i=o.indexOf(".");if(i>=0&&(a=o.slice(i+1),o=o.slice(0,i)),o&&!f.hasOwnProperty(o))throw new Error("unknown type: "+o);return{type:o,name:a}})}H.prototype=at.prototype={constructor:H,on:function(r,f){var o=this._,a=zt(r+"",o),i,w=-1,O=a.length;if(arguments.length<2){for(;++w<O;)if((i=(r=a[w]).type)&&(i=St(o[i],r.name)))return i;return}if(f!=null&&typeof f!="function")throw new Error("invalid callback: "+f);for(;++w<O;)if(i=(r=a[w]).type)o[i]=rt(o[i],r.name,f);else if(f==null)for(i in o)o[i]=rt(o[i],r.name,null);return this},copy:function(){var r={},f=this._;for(var o in f)r[o]=f[o].slice();return new H(r)},call:function(r,f){if((i=arguments.length-2)>0)for(var o=new Array(i),a=0,i,w;a<i;++a)o[a]=arguments[a+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(w=this._[r],a=0,i=w.length;a<i;++a)w[a].value.apply(f,o)},apply:function(r,f,o){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var a=this._[r],i=0,w=a.length;i<w;++i)a[i].value.apply(f,o)}};function St(r,f){for(var o=0,a=r.length,i;o<a;++o)if((i=r[o]).name===f)return i.value}function rt(r,f,o){for(var a=0,i=r.length;a<i;++a)if(r[a].name===f){r[a]=Mt,r=r.slice(0,a).concat(r.slice(a+1));break}return o!=null&&r.push({name:f,value:o}),r}const It=Object.freeze(Object.defineProperty({__proto__:null,dispatch:at},Symbol.toStringTag,{value:"Module"})),Et=xt(It);var Q,ot;function Tt(){if(ot)return Q;ot=1;const r=Et.dispatch,f=Math.PI/180,o={archimedean:Z,rectangular:lt},a=64,i=2048;Q=function(){var n=[256,256],t=w,c=O,y=b,h=X,m=X,p=U,S=V,D=Z,_=[],k=1/0,I=r("word","end"),v=null,$=Math.random,u={},F=ft;u.canvas=function(e){return arguments.length?(F=R(e),u):F},u.start=function(){var e=G(F()),s=st((n[0]>>5)*n[1]),g=null,M=_.length,q=-1,A=[],E=_.map(function(x,l){return x.text=t.call(this,x,l),x.font=c.call(this,x,l),x.style=h.call(this,x,l),x.weight=m.call(this,x,l),x.rotate=p.call(this,x,l),x.size=~~y.call(this,x,l),x.padding=S.call(this,x,l),x}).sort(function(x,l){return l.size-x.size});return v&&clearInterval(v),v=setInterval(P,0),P(),u;function P(){for(var x=Date.now();Date.now()-x<k&&++q<M&&v;){var l=E[q];l.x=n[0]*($()+.5)>>1,l.y=n[1]*($()+.5)>>1,C(e,l,E,q),l.hasText&&N(s,l,g)&&(A.push(l),I.call("word",u,l),g?ut(g,l):g=[{x:l.x+l.x0,y:l.y+l.y0},{x:l.x+l.x1,y:l.y+l.y1}],l.x-=n[0]>>1,l.y-=n[1]>>1)}q>=M&&(u.stop(),I.call("end",u,A,g))}},u.stop=function(){v&&(clearInterval(v),v=null);for(const e of _)delete e.sprite;return u};function G(e){const s=e.getContext("2d",{willReadFrequently:!0});e.width=e.height=1;const g=Math.sqrt(s.getImageData(0,0,1,1).data.length>>2);return e.width=(a<<5)/g,e.height=i/g,s.fillStyle=s.strokeStyle="red",{context:s,ratio:g}}function N(e,s,g){n[0],n[1];for(var M=s.x,q=s.y,A=Math.sqrt(n[0]*n[0]+n[1]*n[1]),E=D(n),P=$()<.5?1:-1,x=-P,l,W,z;(l=E(x+=P))&&(W=~~l[0],z=~~l[1],!(Math.min(Math.abs(W),Math.abs(z))>=A));)if(s.x=M+W,s.y=q+z,!(s.x+s.x0<0||s.y+s.y0<0||s.x+s.x1>n[0]||s.y+s.y1>n[1])&&(!g||it(s,g))&&!Y(s,e,n[0])){for(var T=s.sprite,B=s.width>>5,j=n[0]>>5,d=s.x-(B<<4),tt=d&127,ct=32-tt,ht=s.y1-s.y0,nt=(s.y+s.y0)*j+(d>>5),J,K=0;K<ht;K++){J=0;for(var L=0;L<=B;L++)e[nt+L]|=J<<ct|(L<B?(J=T[K*B+L])>>>tt:0);nt+=j}return!0}return!1}return u.timeInterval=function(e){return arguments.length?(k=e??1/0,u):k},u.words=function(e){return arguments.length?(_=e,u):_},u.size=function(e){return arguments.length?(n=[+e[0],+e[1]],u):n},u.font=function(e){return arguments.length?(c=R(e),u):c},u.fontStyle=function(e){return arguments.length?(h=R(e),u):h},u.fontWeight=function(e){return arguments.length?(m=R(e),u):m},u.rotate=function(e){return arguments.length?(p=R(e),u):p},u.text=function(e){return arguments.length?(t=R(e),u):t},u.spiral=function(e){return arguments.length?(D=o[e]||e,u):D},u.fontSize=function(e){return arguments.length?(y=R(e),u):y},u.padding=function(e){return arguments.length?(S=R(e),u):S},u.random=function(e){return arguments.length?($=e,u):$},u.on=function(){var e=I.on.apply(I,arguments);return e===I?u:e},u};function w(n){return n.text}function O(){return"serif"}function X(){return"normal"}function b(n){return Math.sqrt(n.value)}function U(){return(~~(random()*6)-3)*30}function V(){return 1}function C(n,t,c,y){if(!t.sprite){var h=n.context,m=n.ratio;h.clearRect(0,0,(a<<5)/m,i/m);var p=0,S=0,D=0,_=c.length;for(--y;++y<_;){t=c[y],h.save(),h.font=t.style+" "+t.weight+" "+~~((t.size+1)/m)+"px "+t.font;const l=h.measureText(t.text),W=-Math.floor(l.width/2);let z=(l.width+1)*m,T=t.size<<1;if(t.rotate){var k=Math.sin(t.rotate*f),I=Math.cos(t.rotate*f),v=z*I,$=z*k,u=T*I,F=T*k;z=Math.max(Math.abs(v+F),Math.abs(v-F))+31>>5<<5,T=~~Math.max(Math.abs($+u),Math.abs($-u))}else z=z+31>>5<<5;if(T>D&&(D=T),p+z>=a<<5&&(p=0,S+=D,D=0),S+T>=i)break;h.translate((p+(z>>1))/m,(S+(T>>1))/m),t.rotate&&h.rotate(t.rotate*f),h.fillText(t.text,W,0),t.padding&&(h.lineWidth=2*t.padding,h.strokeText(t.text,W,0)),h.restore(),t.width=z,t.height=T,t.xoff=p,t.yoff=S,t.x1=z>>1,t.y1=T>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,p+=z}for(var G=h.getImageData(0,0,(a<<5)/m,i/m).data,N=[];--y>=0;)if(t=c[y],!!t.hasText){for(var e=t.width,s=e>>5,g=t.y1-t.y0,M=0;M<g*s;M++)N[M]=0;if(p=t.xoff,p==null)return;S=t.yoff;for(var q=0,A=-1,E=0;E<g;E++){for(var M=0;M<e;M++){var P=s*E+(M>>5),x=G[(S+E)*(a<<5)+(p+M)<<2]?1<<31-M%32:0;N[P]|=x,q|=x}q?A=E:(t.y0++,g--,E--,S++)}t.y1=t.y0+A,t.sprite=N.slice(0,(t.y1-t.y0)*s)}}}function Y(n,t,c){c>>=5;for(var y=n.sprite,h=n.width>>5,m=n.x-(h<<4),p=m&127,S=32-p,D=n.y1-n.y0,_=(n.y+n.y0)*c+(m>>5),k,I=0;I<D;I++){k=0;for(var v=0;v<=h;v++)if((k<<S|(v<h?(k=y[I*h+v])>>>p:0))&t[_+v])return!0;_+=c}return!1}function ut(n,t){var c=n[0],y=n[1];t.x+t.x0<c.x&&(c.x=t.x+t.x0),t.y+t.y0<c.y&&(c.y=t.y+t.y0),t.x+t.x1>y.x&&(y.x=t.x+t.x1),t.y+t.y1>y.y&&(y.y=t.y+t.y1)}function it(n,t){return n.x+n.x1>t[0].x&&n.x+n.x0<t[1].x&&n.y+n.y1>t[0].y&&n.y+n.y0<t[1].y}function Z(n){var t=n[0]/n[1];return function(c){return[t*(c*=.1)*Math.cos(c),c*Math.sin(c)]}}function lt(n){var t=4,c=t*n[0]/n[1],y=0,h=0;return function(m){var p=m<0?-1:1;switch(Math.sqrt(1+4*p*m)-p&3){case 0:y+=c;break;case 1:h+=t;break;case 2:y-=c;break;default:h-=t;break}return[y,h]}}function st(n){for(var t=[],c=-1;++c<n;)t[c]=0;return t}function ft(){return document.createElement("canvas")}function R(n){return typeof n=="function"?n:function(){return n}}return Q}var bt=Tt();const Ct=yt(bt);function qt({data:r=[],width:f=500,height:o=350}){const a=et.useRef(null);return et.useEffect(()=>{if(!r.length)return;const i=a.current;i.innerHTML="";const w=pt(r,b=>b.value)||1,O=vt().domain([0,w]).range([12,64]);Ct().size([f,o]).words(r.map(b=>({text:b.text,size:O(b.value)}))).padding(3).rotate(()=>0).font("Impact").fontSize(b=>b.size).on("end",b=>{gt(i).append("svg").attr("width",f).attr("height",o).append("g").attr("transform",`translate(${f/2},${o/2})`).selectAll("text").data(b).enter().append("text").style("font-family","Impact").style("fill",(C,Y)=>wt[Y%10]).attr("text-anchor","middle").attr("font-size",C=>C.size).attr("transform",C=>`translate(${C.x},${C.y}) rotate(${C.rotate})`).text(C=>C.text)}).start()},[r,f,o]),mt.jsx("div",{ref:a})}export{qt as default};
